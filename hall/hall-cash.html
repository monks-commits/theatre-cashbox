<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Схема залу — каса (offline)</title>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js"></script>

<style>
body{font-family:Arial,sans-serif;margin:20px}
.row{display:flex;align-items:center;margin-bottom:4px}
.row-label{width:28px;text-align:right;margin-right:6px;color:#555;font-size:12px}
.seat{
  width:26px;height:26px;
  border:1px solid #ccc;border-radius:6px;
  margin:2px;font-size:11px;
  cursor:pointer;background:#fff
}
.front{background:#fef9c3}
.mid{background:#dbeafe}
.back{background:#e5e7eb}
.amphi{background:#e0f2fe}
.balcony{background:#f3e8ff}
.seat.selected{background:#2563eb;color:#fff}
.seat.sold{background:#9ca3af;color:#fff;cursor:not-allowed}

.section{margin-bottom:24px}
.section-title{text-align:center;color:#666;font-size:13px;margin-bottom:6px}

#summary{margin-top:20px;padding:12px;border:1px solid #ddd;border-radius:10px;width:360px}
button{padding:10px 14px;border-radius:10px;border:0;font-weight:bold;cursor:pointer}
.sell{background:#86efac}
.clear{background:#e5e7eb}
</style>
</head>

<body>

<h1>Схема залу — каса (offline)</h1>
<div id="hall"></div>

<div id="summary">
  <div id="chosen">Обрані місця: —</div>
  <div id="total">Сума: 0 грн</div><br>
  <button class="sell" id="sellBtn" disabled>ПРОДАТИ + ДРУК</button>
  <button class="clear" onclick="clearSelection()">ОЧИСТИТИ</button>
</div>

<script>
const hall = document.getElementById("hall");
const selected = new Map();

function seatEl(key, cls, price){
  const b=document.createElement("button");
  b.className="seat "+cls;
  b.textContent=key.split("-")[1];
  b.dataset.key = key;
  b.onclick=()=>{
    if(b.classList.contains("sold"))return;
    if(selected.has(key)){
      selected.delete(key);
      b.classList.remove("selected");
    }else{
      selected.set(key,price);
      b.classList.add("selected");
    }
    updateSummary();
  };
  return b;
}

function addSection(title, rows){
  const s=document.createElement("div");
  s.className="section";
  s.innerHTML=`<div class="section-title">${title}</div>`;
  rows.forEach(r=>{
    const row=document.createElement("div");
    row.className="row";
    const lab=document.createElement("div");
    lab.className="row-label";
    lab.textContent=r.row;
    row.appendChild(lab);
    r.seats.forEach(seat=>row.appendChild(seat));
    s.appendChild(row);
  });
  hall.appendChild(s);
}

/* ПАРТЕР */
const parter=[];
for(let r=1;r<=18;r++){
  let cls=r<=6?"front":r<=12?"mid":"back";
  const seats=[];
  for(let m=1;m<=20;m++){
    seats.push(seatEl(`P${r}-M${m}`,cls,200));
  }
  parter.push({row:r,seats});
}
addSection("ПАРТЕР",parter);

function updateSummary(){
  const arr=[...selected.keys()];
  document.getElementById("chosen").textContent=
    arr.length?"Обрані місця: "+arr.join(", "):"Обрані місця: —";
  const sum=[...selected.values()].reduce((a,b)=>a+b,0);
  document.getElementById("total").textContent="Сума: "+sum+" грн";
  document.getElementById("sellBtn").disabled=!arr.length;
}

function clearSelection(){
  document.querySelectorAll(".seat.selected").forEach(b=>b.classList.remove("selected"));
  selected.clear();
  updateSummary();
}

document.getElementById("sellBtn").onclick=async()=>{
  for(const key of selected.keys()){
    const btn=document.querySelector(`[data-key="${key}"]`);
    if(btn){
      btn.classList.remove("selected");
      btn.classList.add("sold");
    }
  }
  selected.clear();
  updateSummary();
};
</script>

</body>
</html>
