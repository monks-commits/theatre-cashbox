<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Схема залу — каса (offline)</title>

  <link rel="stylesheet" href="../styles.css" />

  <!-- QR -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js"></script>

  <style>
    .seat{
      width:24px;height:24px;border-radius:6px;
      border:1px solid #d1d5db;
      background:#fff;
      font-size:11px;
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;
      user-select:none;
    }
    .seat:hover{outline:2px solid #2563eb}
    .seat--selected{background:#2563eb!important;color:#fff}
    .seat--sold{background:#9ca3af!important;color:#fff;cursor:not-allowed}
    .seat--blocked{background:#111827!important;color:#fff;cursor:not-allowed}
    .row-line{display:flex;gap:8px;margin-bottom:4px}
    .row-label{width:22px;text-align:right;font-size:11px;color:#6b7280}
    .seats-row{display:flex;gap:4px}
  </style>
</head>

<body>
<main class="main">
<div class="container">
<h1>Схема залу — каса (offline)</h1>

<div id="parter"></div>

<p id="summary">Обрані місця: немає</p>
<p id="sum">Сума: 0 грн</p>

<button id="clear">Очистити</button>
</div>
</main>

<script type="module">
/* ================================
   OFFLINE CASH HALL — WORKING CORE
   ================================ */

const parter = document.getElementById("parter");
const summary = document.getElementById("summary");
const sumEl = document.getElementById("sum");
const clearBtn = document.getElementById("clear");

const selected = new Map();

/* ----- SCHEMA ----- */
const rows = Array.from({length:18}, (_,i)=>({
  row:i+1,
  seats:20,
  price: i+1<=6 ? 200 : i+1<=12 ? 160 : 140
}));

/* ----- HELPERS ----- */
function seatKey(r,s){ return `P${r}-M${s}` }

function updateSummary(){
  if(!selected.size){
    summary.textContent = "Обрані місця: немає";
    sumEl.textContent = "Сума: 0 грн";
    return;
  }
  const keys=[...selected.keys()];
  const total=[...selected.values()].reduce((a,b)=>a+b,0);
  summary.textContent="Обрані місця: "+keys.join("; ");
  sumEl.textContent="Сума: "+total+" грн";
}

/* ----- RENDER ----- */
function render(){
  parter.innerHTML="";
  rows.forEach(r=>{
    const line=document.createElement("div");
    line.className="row-line";

    const lab=document.createElement("div");
    lab.className="row-label";
    lab.textContent=r.row;
    line.appendChild(lab);

    const seats=document.createElement("div");
    seats.className="seats-row";

    for(let s=1;s<=r.seats;s++){
      const btn=document.createElement("button");
      btn.className="seat";
      btn.textContent=s;
      btn.dataset.key=seatKey(r.row,s);
      btn.dataset.price=r.price;

      btn.addEventListener("click",()=>{
        if(btn.classList.contains("seat--sold")) return;

        if(btn.classList.contains("seat--selected")){
          btn.classList.remove("seat--selected");
          selected.delete(btn.dataset.key);
        }else{
          btn.classList.add("seat--selected");
          selected.set(btn.dataset.key, r.price);
        }
        updateSummary();
      });

      seats.appendChild(btn);
    }

    line.appendChild(seats);
    parter.appendChild(line);
  });
}

/* ----- CLEAR ----- */
clearBtn.onclick=()=>{
  document.querySelectorAll(".seat--selected")
    .forEach(b=>b.classList.remove("seat--selected"));
  selected.clear();
  updateSummary();
};

/* ----- BOOT ----- */
render();
updateSummary();

console.log("✅ OFFLINE CASH HALL LOADED");
</script>
</body>
</html>
