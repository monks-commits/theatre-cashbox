<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8">
<title>Схема залу — каса (offline)</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{font-family:Arial,sans-serif;background:#f5f5f5;margin:0;padding:20px}
h1{margin:0 0 12px}

.hall{background:#e5e7eb;padding:16px;border-radius:16px}
.row{display:flex;align-items:center;margin-bottom:4px}
.row-label{width:28px;text-align:right;font-size:12px;color:#555;margin-right:6px}

.seat{
  width:26px;height:26px;margin:2px;
  border-radius:6px;border:1px solid #bbb;
  font-size:11px;cursor:pointer;
  background:#fff;
}
.seat.front{background:#fef9c3}
.seat.mid{background:#dbeafe}
.seat.back{background:#e5e7eb}

.seat.selected{background:#2563eb;color:#fff;border-color:#2563eb}
.seat.sold{background:#9ca3af;color:#fff;cursor:not-allowed}

.sidebar{
  margin-top:20px;
  background:#fff;
  padding:14px;
  border-radius:14px;
  max-width:420px
}
.btn{
  padding:10px 14px;
  border-radius:12px;
  border:0;
  cursor:pointer;
  font-weight:700
}
.btn.sell{background:#fca5a5}
.btn.clear{background:#e5e7eb}
</style>
</head>

<body>

<h1>Схема залу — каса (offline)</h1>

<div class="hall" id="hall"></div>

<div class="sidebar">
  <div id="summaryPlaces">Обрані місця: немає</div>
  <div id="summarySum">Сума: 0 грн</div>
  <br>
  <button class="btn sell" id="btnSell" disabled>ПРОДАТИ</button>
  <button class="btn clear" id="btnClear">ОЧИСТИТИ</button>
</div>

<script>
const hallEl = document.getElementById("hall");
const selected = new Map();

const rows = Array.from({length:18},(_,i)=>({
  row:i+1,
  seats:20,
  price:i<6?200:i<12?160:140,
  cls:i<6?"front":i<12?"mid":"back"
}));

function seatKey(r,s){ return `P${r}-M${s}`; }

function loadSold(){
  try{
    return JSON.parse(localStorage.getItem("cash_sold")||"[]");
  }catch{ return []; }
}
function saveSold(arr){
  localStorage.setItem("cash_sold",JSON.stringify(arr));
}

const sold = new Set(loadSold());

rows.forEach(r=>{
  const rowDiv=document.createElement("div");
  rowDiv.className="row";

  const lab=document.createElement("div");
  lab.className="row-label";
  lab.textContent=r.row;
  rowDiv.appendChild(lab);

  for(let s=1;s<=r.seats;s++){
    const key=seatKey(r.row,s);
    const b=document.createElement("button");
    b.className=`seat ${r.cls}`;
    b.textContent=s;

    if(sold.has(key)){
      b.classList.add("sold");
      b.disabled=true;
    }

    b.onclick=()=>{
      if(b.classList.contains("sold"))return;
      if(b.classList.contains("selected")){
        b.classList.remove("selected");
        selected.delete(key);
      }else{
        b.classList.add("selected");
        selected.set(key,r.price);
      }
      updateSummary();
    };
    rowDiv.appendChild(b);
  }
  hallEl.appendChild(rowDiv);
});

function updateSummary(){
  const keys=[...selected.keys()];
  const sum=[...selected.values()].reduce((a,b)=>a+b,0);
  document.getElementById("summaryPlaces").textContent=
    keys.length?("Обрані місця: "+keys.join("; ")):"Обрані місця: немає";
  document.getElementById("summarySum").textContent="Сума: "+sum+" грн";
  document.getElementById("btnSell").disabled=!keys.length;
}

document.getElementById("btnClear").onclick=()=>{
  selected.clear();
  document.querySelectorAll(".seat.selected").forEach(b=>b.classList.remove("selected"));
  updateSummary();
};

document.getElementById("btnSell").onclick=()=>{
  const keys=[...selected.keys()];
  if(!keys.length)return;

  keys.forEach(k=>sold.add(k));
  saveSold([...sold]);

  document.querySelectorAll(".seat.selected").forEach(b=>{
    b.classList.remove("selected");
    b.classList.add("sold");
    b.disabled=true;
  });

  selected.clear();
  updateSummary();
  alert("Продано (offline)");
};
</script>

</body>
</html>
