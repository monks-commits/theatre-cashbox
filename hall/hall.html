<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Схема залу (каса)</title>

  <link rel="stylesheet" href="../styles.css" />

  <style>
    .hall-layout{display:flex;gap:24px;align-items:flex-start;}
    .hall-left{flex:1 1 auto;min-width:0;}
    .hall-sidebar{width:300px;flex:0 0 300px;}
    .hall-scroll{background:#e5e7eb;border-radius:16px;padding:12px;overflow-x:auto;}
    .hall-inner{width:max(980px,100%);}
    .hall-section{margin-bottom:18px;}
    .hall-section-title{text-align:center;font-size:14px;text-transform:uppercase;color:#6b7280;}
    .row-line{display:flex;align-items:center;gap:8px;margin-bottom:4px;}
    .row-label{width:22px;text-align:right;font-size:11px;color:#6b7280;}
    .seats-row{display:flex;gap:4px;}
    .seat{width:24px;height:24px;border-radius:6px;border:1px solid #d1d5db;
      background:#fff;font-size:11px;cursor:pointer;}
    .seat--selected{background:#2563eb;color:#fff;border-color:#2563eb;}
    .seat--gap-right{margin-right:16px;}
    .amphi-gap{width:24px;}
    .seat--parter-front{background:#fef9c3;}
    .seat--parter-mid{background:#dbeafe;}
    .seat--parter-back{background:#e5e7eb;}
    .seat--amphi{background:#e0f2fe;}
    .seat--balcony{background:#f3e8ff;}
    .seat--lodge{background:#fee2e2;}
  </style>
</head>

<body>
<main class="main">
  <div class="container">
    <h1>Схема залу (каса)</h1>

    <div class="hall-layout">
      <div class="hall-left">
        <div class="hall-scroll">
          <div class="hall-inner">

            <section class="hall-section">
              <div class="hall-section-title">Партер</div>
              <div id="parter-block"></div>
            </section>

            <section class="hall-section">
              <div class="hall-section-title">Амфітеатр</div>
              <div id="amphi-block"></div>
            </section>

            <section class="hall-section">
              <div class="hall-section-title">Балкон</div>
              <div id="balcony-block"></div>
            </section>

          </div>
        </div>
      </div>

      <aside class="hall-sidebar">
        <div class="card">
          <h2>Обрані місця</h2>
          <p id="summary-places">—</p>
          <p id="summary-amount">Сума: 0 грн</p>
          <button id="go-sale" class="button-primary" disabled>
            Перейти до продажу
          </button>
        </div>
      </aside>
    </div>
  </div>
</main>

<script>
  const selected = new Map();

  const parterRows = Array.from({length:18}, (_,i)=>({
    row:i+1,seats:20,
    price:i<6?200:i<12?160:140,
    cls:i<6?"seat--parter-front":i<12?"seat--parter-mid":"seat--parter-back"
  }));

  function seatKey(r,s){ return `P${r}-M${s}` }

  function renderParter(){
    const b=document.getElementById("parter-block");
    parterRows.forEach(r=>{
      const line=document.createElement("div"); line.className="row-line";
      const lab=document.createElement("div"); lab.className="row-label"; lab.textContent=r.row;
      const row=document.createElement("div"); row.className="seats-row";
      for(let s=1;s<=r.seats;s++){
        const btn=document.createElement("button");
        btn.className=`seat ${r.cls}`+(s===10?" seat--gap-right":"");
        btn.textContent=s;
        btn.onclick=()=>toggle(btn,seatKey(r.row,s),r.price);
        row.appendChild(btn);
      }
      line.append(lab,row); b.appendChild(line);
    });
  }

  function toggle(btn,key,price){
    if(selected.has(key)){
      selected.delete(key); btn.classList.remove("seat--selected");
    }else{
      selected.set(key,price); btn.classList.add("seat--selected");
    }
    update();
  }

  function update(){
    const places=[...selected.keys()];
    document.getElementById("summary-places").textContent=
      places.length?places.join(", "):"—";
    const sum=[...selected.values()].reduce((a,b)=>a+b,0);
    document.getElementById("summary-amount").textContent="Сума: "+sum+" грн";
    document.getElementById("go-sale").disabled=!places.length;
  }

  document.getElementById("go-sale").onclick=()=>{
    sessionStorage.setItem("CASH_SALE",JSON.stringify({
      seats:[...selected.keys()],
      amount:[...selected.values()].reduce((a,b)=>a+b,0)
    }));
    location.href="../cashier/sale.html";
  };

  renderParter();
</script>
</body>
</html>
